# Lightweight test stack â€” only infra services, no app containers
# Usage: docker compose -f docker-compose.test.yml up -d
# Used by: CI (ci.yml) and local make test

services:
  pkg-db-test:
    image: pgvector/pgvector:0.8.1-pg17
    container_name: pkg-db-test
    environment:
      POSTGRES_USER: pkg
      POSTGRES_PASSWORD: pkg
      POSTGRES_DB: pkg_test
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U pkg -d pkg_test"]
      interval: 5s
      timeout: 5s
      retries: 10
    tmpfs:
      - /var/lib/postgresql/data   # fast, ephemeral test DB

  pkg-graph-test:
    image: falkordb/falkordb:v4.14.9
    container_name: pkg-graph-test
    ports:
      - "6380:6379"
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "6379", "PING"]
      interval: 5s
      timeout: 5s
      retries: 10
    tmpfs:
      - /data
